<div id="page-title" class="row">
    <div class="twelve columns">
        <img src="/images/ukaid_logo.png" alt="UK aid from the British people">
        <div>
            <div class="breadcrumb">
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/location/country">Aid by Location</a></li>
                    <li><%= data["name"] %></li>
                </ul>
            </div>
            <h1>
                <img src="/images/flags/<%=data["code"].downcase%>.png" alt="Country Flag"/>
                <%=data["name"]%>
            </h1>
        </div>
    </div>
</div>

<%= partial "partials/countries-tabs", :locals => { :active => "summary", :data => data } %>

<div class="row">
    <div class="twelve columns summary">
        <h2 class="visually-hidden">Summary</h2>
        <div class="description"><%= data["description"] %></div>
        <script type="text/javascript">
            $('div.description').expander({
                slicePoint    : 300,
                expandSpeed   : 0,
                collapseSpeed : 0,
                expandText    : 'Read more about <%= data["name"] %>' 
            });
        </script>
    </div>
</div>

<div class="row row-summary">
    <div class="six columns">
        <h3>Key Info</h3>
        <ul class="info-list vertical">
            <li class="fact-item">
                Total Project Budget for <strong><%= data["budget"]["financial_year"] %></strong>
                <span><strong><%= data["budget"]["total"] %></strong></span>
            </li>
            <li class="fact-item">
                % of DFID budget
                <span><strong><%= data["budget"]["percentage_of_dfid_budget"] %>%</strong></span>
            </li>
            <li class="fact-item">
                Active Projects
                <span><strong><%= data["projects"]["active"] %></strong></span>
            </li>
            <% if data["facts"]["population"] then %>
                <li class="fact-item">
                    Population (source: <a href="<%=data["facts"]["population"]["source"]["href"]%>" rel="external"><%=data["facts"]["population"]["source"]["name"]%></a>):
                    <span><strong><%=data["facts"]["population"]["value"]%></strong></span>
                </li>
            <% end %>
            <% if data["facts"]["life_expectancy"] then %>
                <li class="fact-item">
                    Life Expectancy (source: <a href="<%=data["facts"]["life_expectancy"]["source"]["href"]%>" rel="external"><%=data["facts"]["life_expectancy"]["source"]["name"]%></a>):
                    <span><strong><%=data["facts"]["life_expectancy"]["value"]%></strong></span>
                </li>
            <% end %>            
            <% if data["facts"]["income_level"] then %>
                <li class="fact-item">
                    Income Level (source: <a href="<%=data["facts"]["income_level"]["source"]["href"]%>" rel="external"><%=data["facts"]["income_level"]["source"]["name"]%></a>):
                    <span><strong><%=data["facts"]["income_level"]["value"]%></strong></span>
                </li>
            <% end %>            
        </ul>
    </div>

    <div class="six columns" role="presentation">
        <div id="countryMap" class="countryMap"></div>

        <input type="hidden" id="countryName" value="<%=data["name"]%>">
        <input type="hidden" id="countryCode" value="<%=data["code"]%>">
       
        <div id="countryMapDisclaimer" class="disclaimer grey">
            <p><strong>Disclaimer</strong>: Country borders do not necessarily reflect the UK Government's official position.</p>
        </div>
    </div>

</div>

<div class="row">
    <div class="six columns">
         <h3>Sector groups as a percentage of country budget</h3>
         <div class="row">
            <div class="six columns">
                <div id="sectorChart"></div>
            </div>
            <div class="six columns">
                <div id="sectorLegend">
                    <ul class="legend-list">
                        <% data["sector_groups"].each do |sector| %>
                            <li><span class="theme-1 legend-color"></span>
                                <div title="<%=sector["name"]%>" style="white-space: nowrap; text-overflow: ellipsis; overflow: hidden;">
                                    <%=sector["name"]%>
                                </div>
                                <em><%=sector["percentage"]%><span class="visually-hidden">projects</span></em>
                            </li>
                        <% end %>
                    </ul>
                </div>
            </div>
         </div>
         
    </div>
    <div class="six columns">
         <h3 >Project budget total by year</h3>
         <div id="budget-year-chart" style="height: 250px;" class="standard">
        </div>
    </div>
</div>


 <script src="/javascripts/donut.js"></script>
 <script src="/javascripts/progress.js"></script>
 <script src="/javascripts/bar.js"></script>
 <script>
 
    (function(){

        var budgets = <%= ([["Year", "Budget"]] + data["budgets_by_year"].map { |b| [ b['year'], b['budget'] ]}).to_json %>;
        var sectors = <%= data["sector_groups"].to_json %>;

        charts.bar("#budget-year-chart", budgets, ".2s", null, null, ["#D8DCBF"]);
        charts.donut("#sectorChart", sectors, function(d) {
          return d.percentage;
        }, function(d){
          return  d.name
        }, function(d) {
          return d.percentage;
        });

        charts.donutLegend("#sectorLegend", ".legend-color", 14, sectors, function(d){ 
            return d.name 
        });
    })()
 
 </script>


<link rel="stylesheet" type="text/css" href="/javascripts/leaflet/leaflet.css">
<link rel="stylesheet" type="text/css" href="/javascripts/leaflet/MarkerCluster.css">
<link rel="stylesheet" type="text/css" href="/javascripts/leaflet/MarkerCluster.Default.css">

<script type="text/javascript">
    var mapType = "country";
    var locations = <%=data["locations"].to_json%>
</script>
<script src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script src="/javascripts/leaflet/countryBounds.js" type="text/javascript"></script>
<script src="/javascripts/leaflet/leaflet.js"></script>
<script src="/javascripts/leaflet/leaflet-googlemaps.js"></script>
<script src="/javascripts/leaflet/leaflet.markercluster-src.js"></script>
<script src="/javascripts/countrymap.js" type="text/javascript"></script>
